import{C as ue,S as Z,i as $,s as ee,e as m,t as O,k as I,c as b,a as x,g as B,d as i,n as C,b as h,f as w,D as c,E as A,Q as G,T as te,F as q,R as se,I as Ee,h as ke,O as ge,G as we,P as fe}from"./vendor-f40b56c0.js";import{e as M,c as W,g as le,f as de,h as pe,j as Te,k as je}from"./login-96f3aec9.js";import{d as Y}from"./displayError-0ab9c496.js";import{g as he}from"./get-81beb197.js";const Pe=le(de),me=le(pe);async function De(e){const t=fetch(Pe({id:e.fileID.toString()}),{method:"DELETE",headers:M()}),{ok:r,message:n}=await W(t);if(!r)return Y(n),Promise.reject(n)}async function Se(e){const t=fetch(me({id:e.folderID.toString()}),{method:"DELETE",headers:M()}),{ok:r,message:n}=await W(t);if(!r)return Y(n),Promise.reject(n)}async function xe(e){const t=fetch(me({id:e.folderID.toString(),recursive:"yes"}),{method:"DELETE",headers:M()}),{ok:r,message:n}=await W(t);if(!r)return Y(n),Promise.reject(n)}const J=ue([]);let K=[];J.subscribe(e=>{K=e});function Ye(){return K}function Fe(e){return K.includes(e)}function ze(e){const t=!Fe(e);return J.update(r=>(t?r.push(e):r=r.filter(n=>n!==e),r)),t}function ne(){J.set([])}function Ie(e){K.forEach(async t=>{t.fileID?await De(t):e?await xe(t):await Se(t)}),ne(),setTimeout(ae,100)}const D={stack:[],index:0};function Ce(e){D.stack=D.stack.slice(0,D.index+1);let t=D.index;for(;D.stack[t]===e&&t>=0;)D.stack.pop(),t--;return D.stack.push(e),D.index=D.stack.length-1,e}function Ge(){return D.index--,D.index<=0&&(D.index=0),D.stack[D.index]}function Je(){return D.index!==D.stack.length-1&&D.index++,D.stack[D.index]}const re=ue("/");let be="/";re.subscribe(e=>{be=e});function Ue(){return be}const Ne=le(Te);async function Ke(e){const t=await he(e),r=await fetch(Ne({id:t.folderID.toString()}),{headers:M()});if(!r.ok)return Promise.reject("Invalid response");const n=await r.json();return n||Promise.reject("Invalid response")}async function Xe(e){return ne(),re.set(e),Ce(e),`/a/folder/${(await he(e)).folderID}`}let _e;function Ze(e){_e=e}async function ae(){ne(),_e()}function Oe(e){let t,r,n,l,a,u,_,T,o,y,d,E,N,v,S;return{c(){t=m("h1"),r=O("Upload"),n=I(),l=m("form"),a=m("input"),u=I(),_=m("br"),T=I(),o=m("div"),y=m("input"),d=I(),E=m("button"),N=O("Cancel"),this.h()},l(f){t=b(f,"H1",{class:!0});var k=x(t);r=B(k,"Upload"),k.forEach(i),n=C(f),l=b(f,"FORM",{});var p=x(l);a=b(p,"INPUT",{type:!0,name:!0,id:!0}),u=C(p),_=b(p,"BR",{}),T=C(p),o=b(p,"DIV",{class:!0});var j=x(o);y=b(j,"INPUT",{type:!0,class:!0}),d=C(j),E=b(j,"BUTTON",{class:!0});var U=x(E);N=B(U,"Cancel"),U.forEach(i),j.forEach(i),p.forEach(i),this.h()},h(){h(t,"class","text-3xl mb-10 svelte-1jrlwff"),h(a,"type","file"),h(a,"name","file"),h(a,"id","file"),a.multiple=!0,h(y,"type","submit"),y.value="Upload",h(y,"class","btn-good cursor-pointer svelte-1jrlwff"),h(E,"class","btn-bad-light"),h(o,"class","flex justify-evenly mt-10 svelte-1jrlwff")},m(f,k){w(f,t,k),c(t,r),w(f,n,k),w(f,l,k),c(l,a),e[3](a),c(l,u),c(l,_),c(l,T),c(l,o),c(o,y),c(o,d),c(o,E),c(E,N),v||(S=[A(E,"click",G(function(){te(e[0])&&e[0].apply(this,arguments)})),A(l,"submit",G(e[2]))],v=!0)},p(f,[k]){e=f},i:q,o:q,d(f){f&&i(t),f&&i(n),f&&i(l),e[3](null),v=!1,se(S)}}}function Be(e,t,r){let{close:n}=t,l,a="/";re.subscribe(o=>{a=o});function u(){ae(),l.parentElement.reset(),n()}async function _(){const o=[];for(let y=0;y<l.files.length;y++)o.push((async()=>{const d=new FormData,E=a+"/"+l.files[y].name,v=l.files[y].stream(),S=await je().encryptFile(v).catch(j=>{console.error(j)});if(console.log(S),!S)return;d.append("file",S.data),d.append("path",E),d.append("header",S.header),d.append("keyEnc",S.key.keyEnc),d.append("nonce",S.key.nonce);const f=fetch(de,{method:"POST",body:d,headers:M()}),{ok:k,message:p}=await W(f);if(!k)return Y(p),Promise.reject(p)})());await Promise.all(o),u()}function T(o){Ee[o?"unshift":"push"](()=>{l=o,r(1,l)})}return e.$$set=o=>{"close"in o&&r(0,n=o.close)},[n,l,_,T]}class $e extends Z{constructor(t){super();$(this,t,Be,Oe,ee,{close:0})}}function ve(e,t,r){const n=e.slice();return n[5]=t[r],n}function ye(e){let t,r=e[5].name+"",n,l;return{c(){t=m("li"),n=O(r),l=I()},l(a){t=b(a,"LI",{});var u=x(t);n=B(u,r),l=C(u),u.forEach(i)},m(a,u){w(a,t,u),c(t,n),c(t,l)},p(a,u){u&4&&r!==(r=a[5].name+"")&&ke(n,r)},d(a){a&&i(t)}}}function Le(e){let t,r,n,l,a,u,_,T,o,y,d,E,N,v,S,f,k,p,j,U,R,V,H,L=e[2],F=[];for(let s=0;s<L.length;s+=1)F[s]=ye(ve(e,L,s));return{c(){t=m("h1"),r=O("Are you sure?"),n=I(),l=m("p"),a=O("The following files are going to be deleted:"),u=I(),_=m("ul");for(let s=0;s<F.length;s+=1)F[s].c();T=I(),o=m("br"),y=I(),d=m("label"),E=O("Enable recursive deleting"),N=I(),v=m("input"),S=I(),f=m("div"),k=m("button"),p=O("Yes, delete"),j=I(),U=m("button"),R=O("No, cancel"),this.h()},l(s){t=b(s,"H1",{class:!0});var g=x(t);r=B(g,"Are you sure?"),g.forEach(i),n=C(s),l=b(s,"P",{});var P=x(l);a=B(P,"The following files are going to be deleted:"),P.forEach(i),u=C(s),_=b(s,"UL",{class:!0});var Q=x(_);for(let X=0;X<F.length;X+=1)F[X].l(Q);Q.forEach(i),T=C(s),o=b(s,"BR",{}),y=C(s),d=b(s,"LABEL",{for:!0});var ie=x(d);E=B(ie,"Enable recursive deleting"),ie.forEach(i),N=C(s),v=b(s,"INPUT",{name:!0,type:!0}),S=C(s),f=b(s,"DIV",{class:!0});var z=x(f);k=b(z,"BUTTON",{class:!0});var oe=x(k);p=B(oe,"Yes, delete"),oe.forEach(i),j=C(z),U=b(z,"BUTTON",{class:!0});var ce=x(U);R=B(ce,"No, cancel"),ce.forEach(i),z.forEach(i),this.h()},h(){h(t,"class","text-3xl mb-3 svelte-shu4na"),h(_,"class","list-disc ml-5 svelte-shu4na"),h(d,"for","recursive"),h(v,"name","recursive"),h(v,"type","checkbox"),h(k,"class","btn-bad"),h(U,"class","btn-neutral-light"),h(f,"class","flex place-items-center justify-evenly mt-5 svelte-shu4na")},m(s,g){w(s,t,g),c(t,r),w(s,n,g),w(s,l,g),c(l,a),w(s,u,g),w(s,_,g);for(let P=0;P<F.length;P+=1)F[P].m(_,null);w(s,T,g),w(s,o,g),w(s,y,g),w(s,d,g),c(d,E),w(s,N,g),w(s,v,g),v.checked=e[1],w(s,S,g),w(s,f,g),c(f,k),c(k,p),c(f,j),c(f,U),c(U,R),V||(H=[A(v,"change",e[4]),A(k,"click",e[3]),A(U,"click",function(){te(e[0])&&e[0].apply(this,arguments)})],V=!0)},p(s,[g]){if(e=s,g&4){L=e[2];let P;for(P=0;P<L.length;P+=1){const Q=ve(e,L,P);F[P]?F[P].p(Q,g):(F[P]=ye(Q),F[P].c(),F[P].m(_,null))}for(;P<F.length;P+=1)F[P].d(1);F.length=L.length}g&2&&(v.checked=e[1])},i:q,o:q,d(s){s&&i(t),s&&i(n),s&&i(l),s&&i(u),s&&i(_),ge(F,s),s&&i(T),s&&i(o),s&&i(y),s&&i(d),s&&i(N),s&&i(v),s&&i(S),s&&i(f),V=!1,se(H)}}}function Re(e,t,r){let n;we(e,J,T=>r(2,n=T));let{close:l}=t,a=!1;function u(){Ie(a),r(1,a=!1),l()}function _(){a=this.checked,r(1,a)}return e.$$set=T=>{"close"in T&&r(0,l=T.close)},[l,a,n,u,_]}class et extends Z{constructor(t){super();$(this,t,Re,Le,ee,{close:0})}}async function Ae(e){const t=M();t.append("Content-Type","application/json"),console.log(t);const r=fetch(pe,{method:"POST",body:JSON.stringify({path:e}),headers:t}),{ok:n,message:l,res:a}=await W(r);return n?await a.json():(Y(l),Promise.reject(l))}function He(e){let t,r,n,l,a,u,_,T,o,y,d,E,N,v,S,f,k;return{c(){t=m("h1"),r=O("Create a new folder"),n=I(),l=m("form"),a=m("div"),u=m("label"),_=O("Name"),T=I(),o=m("input"),y=I(),d=m("div"),E=m("input"),N=I(),v=m("button"),S=O("Cancel"),this.h()},l(p){t=b(p,"H1",{class:!0});var j=x(t);r=B(j,"Create a new folder"),j.forEach(i),n=C(p),l=b(p,"FORM",{});var U=x(l);a=b(U,"DIV",{class:!0});var R=x(a);u=b(R,"LABEL",{for:!0});var V=x(u);_=B(V,"Name"),V.forEach(i),T=C(R),o=b(R,"INPUT",{type:!0,name:!0,autocomplete:!0,class:!0}),R.forEach(i),y=C(U),d=b(U,"DIV",{class:!0});var H=x(d);E=b(H,"INPUT",{type:!0,class:!0}),N=C(H),v=b(H,"BUTTON",{class:!0});var L=x(v);S=B(L,"Cancel"),L.forEach(i),H.forEach(i),U.forEach(i),this.h()},h(){h(t,"class","text-2xl svelte-lxnaxc"),h(u,"for","name"),h(o,"type","text"),h(o,"name","name"),h(o,"autocomplete","off"),h(o,"class","ml-3 py-1 px-2 border shadow svelte-lxnaxc"),h(a,"class","my-5 svelte-lxnaxc"),h(E,"type","submit"),E.value="Create",h(E,"class","btn-good"),h(v,"class","btn-bad-light"),h(d,"class","flex place-items-center justify-evenly mt-5 svelte-lxnaxc")},m(p,j){w(p,t,j),c(t,r),w(p,n,j),w(p,l,j),c(l,a),c(a,u),c(u,_),c(a,T),c(a,o),fe(o,e[1]),c(l,y),c(l,d),c(d,E),c(d,N),c(d,v),c(v,S),f||(k=[A(o,"input",e[3]),A(v,"click",G(function(){te(e[0])&&e[0].apply(this,arguments)})),A(l,"submit",G(e[2]))],f=!0)},p(p,[j]){e=p,j&2&&o.value!==e[1]&&fe(o,e[1])},i:q,o:q,d(p){p&&i(t),p&&i(n),p&&i(l),f=!1,se(k)}}}function Ve(e,t,r){let n="",{close:l}=t;async function a(){await Ae(Ue()+"/"+n),ae(),l()}function u(){n=this.value,r(1,n)}return e.$$set=_=>{"close"in _&&r(0,l=_.close)},[l,n,a,u]}class tt extends Z{constructor(t){super();$(this,t,Ve,He,ee,{close:0})}}export{tt as C,et as D,$e as U,Je as a,Ke as b,re as c,Ge as d,ne as e,Ze as f,Ye as g,Fe as i,Xe as n,Ce as p,ae as r,J as s,ze as t};
